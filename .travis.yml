os: osx
osx_image: xcode10.2
language: objective-c
sudo: false
env:
  global:
  - THEOS=~/theos
before_install:
  - brew update
  - brew install dpkg ldid
  - git clone --recursive git://github.com/theos/theos.git ~/theos
script:
  - "export VERSION=$(grep 'Version: ' control | sed 's/^.*: //')"
  - "export DESCRIPTION=$(awk '/## v$VERSION/{getline; print}' README.md)"
  - "export FILENAME='packages/'\"$(grep 'Package: ' control | sed 's/^.*: //')\"'_'\"$VERSION\"'_iphoneos-arm.deb'"
  - make package
before_deploy:
  - git config --local user.name "Jeff Rescignano"
  - git config --local user.email "jeff@jeffresc.dev"
  - if [ "$TRAVIS_BRANCH" == "release" ]; then git tag -a v$VERSION -m "$DESCRIPTION"; fi
deploy:
  provider: releases
  api_key:
    secure: nHNsZKZS1K05D8p/n4pGdEKVTENyaecrH+deNSC6YtrQxmQmq2/A71O4wSuhxZgULAFptIvkXKIHBC44S3TuwzHK+1pVgiuQV6zhNZ6QVACR5TaEdDW3iW93+iGUkDdl8KGpWGcYYewu8LcX7gA2rCymhEEcKMAl4mI+1IWfIh9JzZWEXuAOaZa4Oeml8Y9WRPad+OwbsjCWzahVZYkw24wNYeA9SyvNTwR2PVxjszsGsL9PM2gDPtl2gWuiy7V2y1WvsirMfxQmUcjM3on2pFmhJfIcDQQ7afAHs5eeF13pjIMBi0Sy2hcsYtmykK0FuCzRrp6DTyu+yMFSHhh4aJe610J3zHPFEbttOkPkQ6nX5+S6520sSdtM5bz+dC89mLGycvumwrrnqujkpYrBzXFo4htd5bvDcpZcKNqbE5tGaMJStd/2jugVMdQHm9VL9V1WmQUtP8emmEF2nOpnxEMbp6/dMHa5Nu1U7T14BDmEtRdi+HfVw9VucslA0mczEghmntjBef1OPxHrs8epzM/Lf/r2yr3FMal2YNtpvr4DXNTE0qDy/xDjOuLNOG2vsTDXiVQ5uDga74Iwp+ZoxblliWDbqtDkPaZ8DoF7Vg+WBIPvF2PNVMj9fBNXVOaj7MCA4fV55lyVd6AxNUMMSdtGNzh8Feqf3EksCwi+H7k=
  file: $FILENAME
  skip_cleanup: true
  on:
    branches:
      only:
        - release
branches:
  except:
  - /^untagged/
